<?php
/**
 * @file
 * Module file.
 */

/**
 * Implements hook_theme().
 */
function ymca_groupex_theme($existing, $type, $theme, $path) {
  return [
    'groupex_class' => [
      'variables' => [
        'class' => [],
      ],
      'template' => 'groupex-class',
    ],
    'groupex_schedule_day' => [
      'variables' => [
        'classes' => [],
      ],
      'template' => 'groupex-schedule-day',
    ],
    'groupex_schedule_week' => [
      'variables' => [
        'days' => [],
      ],
      'template' => 'groupex-schedule-week',
    ],
  ];
}

/**
 * Implements hook_preprocess_node().
 */
function ymca_groupex_preprocess_node(&$variables) {
  // Pass the form to the schedules page.
  if ($variables['node']->bundle() == 'location' && $variables['view_mode'] == 'schedules') {
    $form = \Drupal::formBuilder()->getForm('Drupal\ymca_groupex\Form\FindClassesForm');
    $variables['form_find_classes'] = \Drupal::service('renderer')->render($form, FALSE);
  }

  // Pass the search results to the schedules page.
  if ($variables['node']->bundle() == 'location' && $variables['view_mode'] == 'groupex') {

    // Get classes schedules.
    $fetcher = new \Drupal\ymca_groupex\GroupexScheduleFetcher(\Drupal::request()->query->all());
    $schedule = $fetcher->getSchedule();

    $a = 10;

//    // Wrap every class into theme function.
//    $items = array_map(function($class) {
//      return [
//        '#theme' => 'groupex_class',
//        '#class' => $class,
//      ];
//    }, $classes);
//
//    // Here just return a list of themed classes.
//    // @todo [FrontEnd Dev] You may add additional elements to the page here.
//    $results = [
//      '#theme' => 'item_list',
//      '#items' => $items,
//    ];

    $variables['groupex_search_results'] = \Drupal::service('renderer')->render($results, FALSE);

  }
}
